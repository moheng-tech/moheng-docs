Super-Trace API 接口说明
---------------------------------------


注册
::::::::::::::::::::::::::::::::::

**简要描述：**

-  注册新用户

**请求URL：** - ``http://localhost:3001/register``

**请求方式：** - POST

**参数：**

======== ==== ====== ==============================
参数名   必选 类型   说明
======== ==== ====== ==============================
type     是   Number 前端类型 0：微信小程序；1：APP
appid    是   string 前端用户唯一编码
password 是   string 密码
======== ==== ====== ==============================

**请求示例**

::

   {
       "type":0,
       "appid":"oLxDRv13VuRSdhPGGRsQu9uqPNJ4",
       "password":"123"
   }

**返回示例**

::

   {
       "success":true,
       "statusCode":200,
       "message":"",
       "data":{
           "appid":"oLxDRv13VuRSdhPGGRsQu9uqPNJ4",
           "address":"0x29e266705f872e853b5503f643af865d880d20a8",
           "keyStore":"{\"version\":3,\"id\":\"fda4f894-d974-454e-9b01-4f65b82775f0\",\"address\":\"29e266705f872e853b5503f643af865d880d20a8\",\"crypto\":{\"ciphertext\":\"9a89bce0b4721ccadf8c881a78fbe9ee5e77106b1d60f1d668955f4e60e83942\",\"cipherparams\":{\"iv\":\"30bf8e5a0a1e9602f32ebe3c19809587\"},\"cipher\":\"aes-128-ctr\",\"kdf\":\"scrypt\",\"kdfparams\":{\"dklen\":32,\"salt\":\"617353e8f9c6c43316dc0b9ba90d73a7e43fc3619cf9d30691c0511c5be874b9\",\"n\":8192,\"r\":8,\"p\":1},\"mac\":\"8667b0ae2c4add0d9ec3bf15f8bfac466e703bfaf8ccd7420badd7fe8b9fa30c\"}}", "privateKey":"0xea126713238fe07c938bddac6c912187e7ec1663fd315d364600d713c6d76f57"
       }
   }

**返回参数说明**

========== ======= ============
参数名     类型    说明         
========== ======= ============
statusCode number  状态码       
success    boolean true / false 
message    string  异常说明     
data       object  查询信息     
========== ======= ============

========== ====== ================
data参数名 类型   说明             
========== ====== ================
appid      string 前端用户唯一编码 
address    string 用户地址         
keyStore   string 用户keyStore     
privateKey string 用户私钥         
========== ====== ================

------------------------------------------------------------------------------------

用户登录
::::::::::::::::::::::::::::::::::

**简要描述：**

-  用户登录

**请求URL：** - ``http://localhost:3001/checkBackLogin``

**请求方式：** - POST

**参数：**

========== ==== ====== ==============================
参数名     必选 类型   说明
========== ==== ====== ==============================
userAddr   是   string 用户地址
type       是   number 前端类型 0：微信小程序；1：APP
appid      是   string 前端用户唯一编码
privateKey 是   string 用户私钥
========== ==== ====== ==============================

**请求示例**

::

   {
       "userAddr": "0x29e266705f872e853b5503f643af865d880d20a8",
       "type": 0,
       "appid": "oLxDRv13VuRSdhPGGRsQu9uqPNJ4",
       "privateKey": "0xea126713238fe07c938bddac6c912187e7ec1663fd315d364600d713c6d76f57"
   }

**返回示例**

::

     {
       "success": true,
       "statusCode": 200,
       "message": "success",
       "data":""
   }

**返回参数说明**

========== ======= ============
参数名     类型    说明         
========== ======= ============
statusCode number  状态码       
success    boolean true / false 
message    string  异常说明     
data       object  查询信息     
========== ======= ============

------------------------------------------------------------------------------------

获取用户角色
::::::::::::::::::::::::::::::::::

**简要描述：**

-  根据溯源二维码信息获取用户角色，后台生成的溯源码，不同用户扫码，会有不同的角色，根据返回值做相应的业务逻辑。

**请求URL：** - ``http://localhost:3001/getCustomRole``

**请求方式：** - POST

**参数：**

+----------+------+--------+----------------------------------------+
| 参数名   | 必选 | 类型   | 说明                                   |
+==========+======+========+========================================+
| userAddr | 是   | string | 用户地址                               |
+----------+------+--------+----------------------------------------+
| params   | 是   | string | 二维码信息（包含                       |
|          |      |        | 产品编号和二维码编号用“&”拼接）,第一个 |
|          |      |        | 参数为二维码编号,第二个参数为产品编号  |
+----------+------+--------+----------------------------------------+

**请求示例**

::

   {
       "userAddr": "0x29e266705f872e853b5503f643af865d880d20a8",
       "params": "11&0",
   }

**返回示例**

::

   {
       "success":true,
       "statusCode":200,
       "message":"",
       "data":{
           "productNo":"0",
           "key":"11",
           "role":0
       }
   }

**返回参数说明**

========== ======= ============
参数名     类型    说明         
========== ======= ============
statusCode number  状态码       
success    boolean true / false 
message    string  异常说明     
data       object  查询信息     
========== ======= ============

========== ====== ==================================
data参数名 类型   说明                               
========== ====== ==================================
productNo  string 产品编号                           
key        string 二维码编号                         
role       number 用户角色 0：普通用户 1：可编辑角色 
========== ====== ==================================

------------------------------------------------------------------------------------

查询产品信息
::::::::::::::::::::::::::::::::::

**简要描述：**

-  根据上一个接口产品编号查询产品详细信息

**请求URL：** - ``http://localhost:3001/getProduct``

**请求方式：** - POST

**参数：**

========= ==== ====== ========
参数名    必选 类型   说明
========= ==== ====== ========
productNo 是   string 产品编号
========= ==== ====== ========

**请求示例**

::

   {
       "productNo": "0",
   }

**返回示例**

::

   {
       "success":true,
       "statusCode":200,
       "message":"",
       "data":{
           "_id":"5f0fb703dac233f89653581f",
           "productNo":"1",
           "productName":"司法溯源",
           "productNameShort":"司法溯源",
           "standard":"",
           "productImg":"/img/upload/upload_2ec0c57122766e6cb8c9e52c8d6dff46.jpg",
           "productIntro":"司法溯源测试",
           "updateTime":1595414458141,
           "productStatus":1,
           "supplierName":"上海科技信息",
           "supplierAddress":"上海大厦527"
       }
   }

**返回参数说明**

========== ======= ============
参数名     类型    说明         
========== ======= ============
statusCode number  状态码       
success    boolean true / false 
message    string  异常说明     
data       object  查询信息     
========== ======= ============

================ ====== ==========================
data参数名       类型   说明                       
================ ====== ==========================
productNo        string 产品编号                   
productName      string 产品名称                   
productNameShort string 产品简称                   
standard         string 规格                       
supplierName     string 供应商名称                 
supplierAddress  string 供应商地址                 
productImg       string 产品图片路径               
productIntro     string 产品简介                   
updateTime       number 最近更新时间戳             
productStatus    number 产品状态 0：已删除 1：正常 
================ ====== ==========================

-----------------------------------------------------------------------------------

查询产品步骤列表
::::::::::::::::::::::::::::::::::

**简要描述：**

-  根据产品编号查询产品步骤

**请求URL：** - ``http://localhost:3001/getProductStepList``

**请求方式：** - POST

**参数：**

========= ==== ====== ========
参数名    必选 类型   说明
========= ==== ====== ========
productNo 是   string 产品编号
========= ==== ====== ========

**请求示例**

::

   {
       "productNo": "0",
   }

**返回示例**

::

   {
       "success":true,
       "statusCode":200,
       "message":"",
       "data":[
           {
               "_id":"5f0ee274e854acf6697152f2",
               "stepName":"入场流转",
               "stepNo":"6261594810996691",
               "stepIndex":1,
               "productNo":"0",
               "labelJson":"[{\"labelNo\":\"686191594810966112\",\"labelName\":\"操作人\",\"options\":[],\"elementType\":\"0\",\"placeholder\":\"请输入不超过20汉字\"},{\"labelNo\":\"040211594810978347\",\"labelName\":\"性别\",\"options\":[\"男\",\"女\"],\"elementType\":\"2\",\"placeholder\":\"\"},{\"labelNo\":\"393671594810990799\",\"labelName\":\"操作时间\",\"options\":[],\"elementType\":\"0\",\"placeholder\":\"\"}]",
               "updateTime":1594977266711,
               "stepStatus":1
           },
           {
               "_id":"5f0ee2c7e854acf6697152f3",
               "stepName":"厂内操作",
               "stepNo":"4651594811079282",
               "stepIndex":2,
               "productNo":"0",
               "labelJson":"[{\"labelNo\":\"327031594811052948\",\"labelName\":\"操作人\",\"options\":[],\"elementType\":\"0\",\"placeholder\":\"请输入操作人\"},{\"labelNo\":\"691781594811058565\",\"labelName\":\"地点\",\"options\":[],\"elementType\":\"0\",\"placeholder\":\"请输入地点\"}]",
               "updateTime":1595228424733,
               "stepStatus":1
           }]
   }

**返回参数说明**

========== ======= ====================
参数名     类型    说明                 
========== ======= ====================
statusCode number  状态码               
success    boolean true / false         
message    string  异常说明             
data       object  返回数组（步骤列表） 
========== ======= ====================

============== ====== ==========================
data数组参数名 类型   说明                       
============== ====== ==========================
stepName       string 步骤名称                   
stepNo         string 步骤编号                   
stepIndex      string 步骤排序号                 
productNo      string 步骤关联的产品编号         
labelJson      string 产品步骤详细信息           
updateTime     number 步骤更新时间戳             
stepStatus     number 步骤状态 0：已删除 1：正常 
============== ====== ==========================

-----------------------------------------------------------------------------------

查询产品单个步骤详细信息
::::::::::::::::::::::::::::::::::

**简要描述：**

-  根据产品编号和步骤编号查询产品单个步骤

**请求URL：** - ``http://localhost:3001/getProductStep``

**请求方式：** - POST

**参数：**

========= ==== ====== ========
参数名    必选 类型   说明
========= ==== ====== ========
productNo 是   string 产品编号
stepNo    是   string 步骤编号
========= ==== ====== ========

**请求示例**

::

   {
       "productNo":"0",
       "stepNo":"6261594810996691"
   }

**返回示例**

::

   {
       "success":true,
       "statusCode":200,
       "message":"",
       "data":{
           "_id":"5f0ee274e854acf6697152f2",
           "stepName":"入场流转",
           "stepNo":"6261594810996691",
           "stepIndex":1,
           "productNo":"0",
           "labelJson":"[{\"labelNo\":\"686191594810966112\",\"labelName\":\"操作人\",\"options\":[],\"elementType\":\"0\",\"placeholder\":\"请输入不超过20汉字\"},{\"labelNo\":\"040211594810978347\",\"labelName\":\"性别\",\"options\":[\"男\",\"女\"],\"elementType\":\"2\",\"placeholder\":\"\"},{\"labelNo\":\"393671594810990799\",\"labelName\":\"操作时间\",\"options\":[],\"elementType\":\"0\",\"placeholder\":\"\"}]",
           "updateTime":1594977266711,
           "stepStatus":1
       }
   }

**返回参数说明**

========== ======= ============
参数名     类型    说明         
========== ======= ============
statusCode number  状态码       
success    boolean true / false 
message    string  异常说明     
data       object  查询信息     
========== ======= ============

========== ====== ==========================
data参数名 类型   说明                       
========== ====== ==========================
stepName   string 步骤名称                   
stepNo     string 步骤编号                   
stepIndex  string 步骤排序号                 
productNo  string 步骤关联的产品编号         
labelJson  string 产品步骤详细信息           
updateTime number 步骤更新时间戳             
stepStatus number 步骤状态 0：已删除 1：正常 
========== ====== ==========================

================= ====== ========================================
labelJson详细说明 类型   说明                                     
================= ====== ========================================
labelNo           string 标签编号                                 
labelName         string 标签名称                                 
elementType       string 元素类型 0：文本框；1：多选框；2：单选框 
options           array  元素信息列表，elementType为1或2时存在    
placeholder       string 提示显示信息                             
================= ====== ========================================


-----------------------------------------------------------------------------------

提交溯源（点）步骤内容
::::::::::::::::::::::::::::::::::

**简要描述：**

-  提交步骤信息

**请求URL：** - ``http://localhost:3001/updateInfo``

**请求方式：** - POST

**参数：**

+-----------------+-------------+--------------------+-----------------+
| 参数名          | 必选        | 类型               | 说明            |
+=================+=============+====================+=================+
| productNo       | 是          | string             | 产品编号        |
+-----------------+-------------+--------------------+-----------------+
| stepNo          | 是          | string             | 步骤编号        |
+-----------------+-------------+--------------------+-----------------+
| userAddr        | 是          | string             | 用户地址        |
+-----------------+-------------+--------------------+-----------------+
| key             | 是          | string             | 二维码编号      |
+-----------------+-------------+--------------------+-----------------+
| info            | 是          | string             | 需要提交的信息  |
|                 |             |                    | 由查询的步骤    |
|                 |             |                    | 详情拼接而成的  |
|                 |             |                    | json字符串“key  |
|                 |             |                    | ”为步骤详情的la |
|                 |             |                    | belName动态字段 |
|                 |             |                    | ，“value”为用户 |
|                 |             |                    | 所填的对应数据  |
+-----------------+-------------+--------------------+-----------------+

**请求示例**

::

   {
       "userAddr":"0x29e266705f872e853b5503f643af865d880d20a8",
       "productNo":"0",
       "stepNo":"6261594810996691",
       "key":"11",
       "info":"{\"操作人\":\"张三\",\"性别\":\"男\",\"操作时间\":\"2020-07-24\"}"
   }

**返回示例**

::

   {
       "success":true,
       "statusCode":200,
       "message":"",
       "data":""
   }

**返回参数说明**

========== ======= ============
参数名     类型    说明         
========== ======= ============
statusCode number  状态码       
success    boolean true / false 
message    string  异常说明     
data       object  无           
========== ======= ============


-----------------------------------------------------------------------------------

获取上链数据信息
::::::::::::::::::::::::::::::::::

**简要描述：**

-  根据二维码key值获取上链数据

**请求URL：** - ``http://localhost:3001/getTraceInfo``

**请求方式：** - POST

**参数：**

====== ==== ====== ==========
参数名 必选 类型   说明
====== ==== ====== ==========
key    是   string 二维码编号
====== ==== ====== ==========

**请求示例**

::

   {
       "key":"1"
   }

**返回示例**

::

   {
       "success":true,
       "statusCode":200,
       "message":"",
       "data":{
           "success":true,
           "statusCode":200,
           "message":"",
           "data":{
     "txHash":"0x33e84432be1aefc80ea958d8b008b28527f406e6c262816e4558f621311a2961",
               "owner":"0xa5f6e11baba9750995f2ef4bbdb3111ef3bef893",
               "traceInfo":"[\"{\\\"操作人\\\":\\\"于永良\\\",\\\"性别\\\":\\\"男\\\",\\\"操作时间\\\":\\\"2020-07-21\\\"}\",\"{\\\"操作 人\\\":\\\"于永良\\\",\\\"地点\\\":\\\"上海\\\"}\",\"{\\\"操作人\\\":\\\"于永良\\\",\\\"类型\\\":[\\\"动漫\\\",\\\"运动\\\",\\\"摄影\\\"]}\",\"{\\\"类型\\\":[\\\"超市\\\",\\\"卖场\\\"],\\\"消费者\\\":\\\"人民群众\\\"}\"]"
           }
       }
   }

**返回参数说明**

========== ======= ============
参数名     类型    说明         
========== ======= ============
statusCode number  状态码       
success    boolean true / false 
message    string  异常说明     
data       object  查询信息     
========== ======= ============

========== ====== =====================================
data参数名 类型   说明                                  
========== ====== =====================================
txHash     string 上链Hash值                            
owner      string 上链人                                
traceInfo  string 上链的详情信息列表，数据为array字符串 
========== ====== =====================================

-----------------------------------------------------------------------------------

获取用户绑定产品总数量
::::::::::::::::::::::::::::::::::

**简要描述：**

-  根据用户地址获取用户绑定产品总数量

**请求URL：** - ``http://localhost:3001/getMyProductCount``

**请求方式：** - POST

**参数：**

======== ==== ====== ========
参数名   必选 类型   说明
======== ==== ====== ========
userAddr 是   string 用户地址
======== ==== ====== ========

**请求示例**

::

   {
       "userAddr":"0xa5f6e11baba9750995f2ef4bbdb3111ef3bef893"
   }

**返回示例**

::

   {
       "success":true,
       "statusCode":200,
       "message":"",
       "data":0
   }

**返回参数说明**

========== ======= ==================
参数名     类型    说明               
========== ======= ==================
statusCode number  状态码             
success    boolean true / false       
message    string  异常说明           
data       number  用户绑定产品总数量 
========== ======= ==================


-----------------------------------------------------------------------------------

获取用户绑定产品总标签量
::::::::::::::::::::::::::::::::::

**简要描述：**

-  根据用户地址获取用户绑定产品总标签（拥有的二维码数量）

**请求URL：** - ``http://localhost:3001/getMyProductTagCount``

**请求方式：** - POST

**参数：**

======== ==== ====== ========
参数名   必选 类型   说明
======== ==== ====== ========
userAddr 是   string 用户地址
======== ==== ====== ========

**请求示例**

::

   {
       "userAddr":"0xa5f6e11baba9750995f2ef4bbdb3111ef3bef893"
   }

**返回示例**

::

   {
       "success":true,
       "statusCode":200,
       "message":"",
       "data":0
   }

**返回参数说明**

========== ======= ====================
参数名     类型    说明                 
========== ======= ====================
statusCode number  状态码               
success    boolean true / false         
message    string  异常说明             
data       number  用户拥有的二维码数量 
========== ======= ====================


-----------------------------------------------------------------------------------

获取用户获取用户绑定产品列表
::::::::::::::::::::::::::::::::::

**简要描述：**

-  根据用户地址获取用户获取用户绑定产品列表

**请求URL：** - ``http://localhost:3001/getMyProductList``

**请求方式：** - POST

**参数：**

======== ==== ====== ========
参数名   必选 类型   说明
======== ==== ====== ========
userAddr 是   string 用户地址
======== ==== ====== ========

**请求示例**

::

   {
       "userAddr":"0xa5f6e11baba9750995f2ef4bbdb3111ef3bef893"
   }

**返回示例**

::

   {
       "success":true,
       "statusCode":200,
       "message":"",
       "data":[
           {
               "_id":"5f0ee249e854acf6697152f1",
               "productNo":"0",
               "productName":" 土肥溯源",
               "productNameShort":"土肥溯源101",
               "standard":"10kg",
               "supplierName":"墨珩",
               "supplierAddress":"上海527",        
               "productImg":"/img/upload/upload_708789daf00c90bee8780b18c32d9761.png",
               "productIntro":"高洁净度的生物有机肥。",
               "updateTime":1594965881314,
               "productStatus":1
           }]
   }

**返回参数说明**

========== ======= ============
参数名     类型    说明         
========== ======= ============
statusCode number  状态码       
success    boolean true / false 
message    string  异常说明     
data       array   产品列表     
========== ======= ============

================ ====== ==========================
data数组参数名   类型   说明                       
================ ====== ==========================
productNo        string 产品编号                   
productName      string 产品名称                   
productNameShort string 产品简称                   
standard         string 规格                       
supplierName     string 供应商名称                 
supplierAddress  string 供应商地址                 
productImg       string 产品图片路径               
productIntro     string 产品简介                   
updateTime       number 最近更新时间戳             
productStatus    number 产品状态 0：已删除 1：正常 
================ ====== ==========================



-----------------------------------------------------------------------------------

拥有者转移到下一步骤绑定账户
::::::::::::::::::::::::::::::::::
    
**简要描述：** 

- Token拥有者转移到下一步骤绑定账户

**请求URL：** - ``http://localhost:3001/changeNextStepOwner``
  
**请求方式：** - POST 

**参数：** 

================ ==== ====== ==========
参数名           必选 类型   说明
================ ==== ====== ==========
productNo        是   string 产品编号
stepNo           是   string 步骤编号
userAddr         是   string 账户地址
userPrivateKey   是   string 账户私钥
key              是   string 二维码编号
================ ==== ====== ==========

**请求示例**
 
::

	{
	    "productNo":"0",
		"stepNo":"6261594810996691",
		"userAddr":"0xa5f6e11baba9750995f2ef4bbdb3111ef3bef893",
		"userPrivateKey":"0x93fad2559a63ed636d145fd7488e4a0f8c7ec3232028102ffcbbef871ef657e8",
		"key":"11"
	}

**返回示例**

::
	
	{
	    "success":true,
	    "statusCode":200,
	    "message":"",
	    "data":""
	}


**返回参数说明** 

========== ======= ============
参数名     类型    说明         
========== ======= ============
statusCode number  状态码       
success    boolean true / false 
message    string  异常说明     
data       string        
========== ======= ============



-----------------------------------------------------------------------------------

获取华为云表单上传签名
::::::::::::::::::::::::::::::::::
    
**简要描述：** 

- 获取华为云表单上传文件签名

**请求URL：** - ``http://localhost:3001/getHuaWeiYunSignature``
  
**请求方式：** - POST 

**参数：** 

======== ==== ====== ========
参数名   必选 类型   说明
======== ==== ====== ========
无 无   无 无
======== ==== ====== ========

**请求示例**

::
	
	{}


**返回示例**

::
	
	{
	    "success":true,
	    "statusCode":200,
	    "message":"",
	    "data":{
	            "server":"https://fileup.obs.cn-east-3.myhuaweicloud.com",
	            "policy":"*************",
	            "signature":"*************"
	        }
	}


**返回参数说明** 

========== ======= ============
参数名     类型    说明         
========== ======= ============
statusCode number  状态码       
success    boolean true / false 
message    string  异常说明     
data       object  返回对象 
========== ======= ============

================ ====== ==========================
data数组参数名   类型   说明                       
================ ====== ==========================
server           string 华为云上传服务名称
policy           string 对应表单中policy字段
signature        string 签名，对应表单中的signature字段
================ ====== ==========================



-----------------------------------------------------------------------------------

下载华为云上文件
::::::::::::::::::::::::::::::::::
    
**简要描述：** 

- 下载华为云上文件

**请求URL：** - ``http://localhost:3001/downLoadFile``
  
**请求方式：** - GET 

**参数：** 

======== ==== ====== ========================
参数名   必选 类型   说明
======== ==== ====== ========================
isIpfs   是   number 文件上传的类型 1：IPFS
fileName 是   string 文件名称
======== ==== ====== ========================


**请求示例**
::
	
	http://localhost:3001/downLoadFile?isIpfs=1&fileName=9c5d3822364ece8b88b4937fd3f7d70529994296a761f337ce03d742893dc29946aaf835c6ea4525d3e74b8502d3f1dd.png


**返回示例**

::

	无


**返回参数说明** 

文件流